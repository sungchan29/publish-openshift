# OpenShift 3.11 ì„¤ì¹˜ë¥¼ ìœ„í•œ Ansible Inventory êµ¬ì„±

ì´ ë¬¸ì„œëŠ” OpenShift Container Platform 3.11 ì„¤ì¹˜ì— ì‚¬ìš©ë˜ëŠ” ìµœì¢… Ansible ì¸ë²¤í† ë¦¬ íŒŒì¼(`ose-v3.11.784-inventory-hosts`)ì˜ ì „ì²´ êµ¬ì„±ì„ ì„¤ëª…í•©ë‹ˆë‹¤. ê° ë³€ìˆ˜ëŠ” ê¸°ëŠ¥ë³„ë¡œ ê·¸ë£¹í™”ë˜ì–´ ìˆìœ¼ë©°, ê³ ê°€ìš©ì„±(HA) ë° ì˜¤í”„ë¼ì¸(Disconnected) í™˜ê²½ì„ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

## ì°¸ê³  ìë£Œ (References)

  * [Red Hat: Configuring the Inventory File](https://docs.redhat.com/en/documentation/openshift_container_platform/3.11/html/installing_clusters/install-config-configuring-inventory-file)
  * [Red Hat: Advanced Installation Variables](https://www.google.com/search?q=https://docs.redhat.com/en/documentation/openshift_container_platform/3.11/html/advanced_installation/adv-install-cluster-variables)
  * [Red Hat: Installing Cluster Metrics](https://www.google.com/search?q=https://docs.redhat.com/en/documentation/openshift_container_platform/3.11/html/installing_and_configuring_cluster_metrics/installing-cluster-metrics)
  * [GitHub: OpenShift Ansible Inventory Example](https://github.com/openshift/openshift-ansible/blob/release-3.11/inventory/hosts.example)

-----

## `[OSEv3:children]`

ì„¤ì¹˜ì— í¬í•¨ë  ëª¨ë“  í˜¸ìŠ¤íŠ¸ ê·¸ë£¹(masters, nodes, etcd, new\_nodes)ì„ ì •ì˜í•˜ëŠ” ìµœìƒìœ„ ê·¸ë£¹ì…ë‹ˆë‹¤.

```ini
[OSEv3:children]
masters
nodes
etcd
```

## `[OSEv3:vars]`

í´ëŸ¬ìŠ¤í„° ì „ì²´ì— ì ìš©ë˜ëŠ” ê¸€ë¡œë²Œ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ëŠ” í•µì‹¬ ì˜ì—­ì…ë‹ˆë‹¤.

### ê¸°ë³¸ í´ëŸ¬ìŠ¤í„° ë° ë²„ì „ ì„¤ì •

Ansible ì ‘ì† ê³„ì •, OpenShift ë°°í¬ ìœ í˜•, ì„¤ì¹˜í•  ì´ë¯¸ì§€ ë° RPM ë²„ì „ì„ ì§€ì •í•©ë‹ˆë‹¤.

```ini
ansible_ssh_user=root
ansible_become=true

openshift_deployment_type=openshift-enterprise
debug_level=2

openshift_image_tag=v3.11.784
openshift_pkg_version=-3.11.784
```

### ì˜¤í”„ë¼ì¸/Disconnected ì„¤ì¹˜ ì„¤ì •

ì¸í„°ë„·ì´ ì°¨ë‹¨ëœ í™˜ê²½ì—ì„œ ë‚´ë¶€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ë³€ìˆ˜ì…ë‹ˆë‹¤.

```ini
osm_etcd_image=bst01.ocp3.cloudpang.lan:5000/rhel7/etcd:3.2.28
oreg_url=bst01.ocp3.cloudpang.lan:5000/openshift3/ose-${component}:${version}
openshift_docker_ent_reg=''
```

### ë§ˆìŠ¤í„° ë° API/ì½˜ì†” ì„¤ì •

ë§ˆìŠ¤í„° ê³ ê°€ìš©ì„±(HA)ì„ ìœ„í•œ ë‚´ë¶€/ì™¸ë¶€ ë¡œë“œ ë°¸ëŸ°ì„œ ì£¼ì†Œì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¼ìš°íŒ…ì„ ìœ„í•œ ê¸°ë³¸ ì„œë¸Œë„ë©”ì¸ì„ ì„¤ì •í•©ë‹ˆë‹¤.

```ini
openshift_master_api_port=8443
openshift_master_console_port=8443

openshift_master_cluster_method=native
openshift_master_cluster_hostname=master.ocp3.cloudpang.lan
openshift_master_cluster_public_hostname=csmaster.ocp3.cloudpang.lan

openshift_master_default_subdomain=apps.ocp3.cloudpang.lan
```

### Docker ì„¤ì •

ëª¨ë“  ë…¸ë“œì— ì„¤ì¹˜ë  Docker ë°ëª¬ì˜ ì˜µì…˜ì„ ì§€ì •í•˜ê³ , ì˜¤í”„ë¼ì¸ í™˜ê²½ì„ ìœ„í•´ ë‚´ë¶€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

```ini
#docker_version=1.13.1
openshift_docker_insecure_registries='bst01.ocp3.cloudpang.lan:5000,172.32.0.0/16,docker-registry.default.svc:5000'
openshift_docker_options='-l warn --log-opt max-size=20M --log-opt max-file=3'
```

### ë„¤íŠ¸ì›Œí¬ ì„¤ì • (SDN)

Podì™€ Serviceê°€ ì‚¬ìš©í•  ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­(CIDR)ê³¼ SDN(Software Defined Network) í”ŒëŸ¬ê·¸ì¸ ì¢…ë¥˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

```ini
os_sdn_network_plugin_name='redhat/openshift-ovs-multitenant'
osm_cluster_network_cidr=172.33.0.0/16
openshift_portal_net=172.32.0.0/16
osm_host_subnet_length=9
```

### ì¸ì¦ì„œ ë° ë³´ì•ˆ ì„¤ì •

ìë™ ìƒì„±ë˜ëŠ” ì¸ì¦ì„œì˜ ìœ íš¨ ê¸°ê°„ì„ ëŠ˜ë¦¬ê³ , ë…¸ë“œ CSR(ì¸ì¦ì„œ ì„œëª… ìš”ì²­)ì„ ìë™ ìŠ¹ì¸í•˜ë©°, ì‚¬ìš©ì ì¸ì¦ ë°©ì‹ì„ `htpasswd`ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

```ini
openshift_ca_cert_expire_days=36500
openshift_node_cert_expire_days=36500
openshift_master_cert_expire_days=36500
etcd_ca_default_days=36500
openshift_hosted_registry_cert_expire_days=36500

openshift_master_bootstrap_auto_approve=true
openshift_master_bootstrap_auto_approver_node_selector={"node-role.kubernetes.io/master":"true"}
osm_controller_args={"experimental-cluster-signing-duration": ["20m"]}

openshift_master_identity_providers=[{'name': 'htpasswd_auth', 'login': 'true', 'challenge': 'true', 'kind': 'HTPasswdPasswordIdentityProvider'}]
```

### ì„ íƒì  ì»´í¬ë„ŒíŠ¸ ë° ì• ë“œì˜¨ ì„¤ì •

í´ëŸ¬ìŠ¤í„° ëª¨ë‹ˆí„°ë§ì„ ìœ„í•œ ì˜êµ¬ ì €ì¥ì†Œ(PV)ë¥¼ í™œì„±í™”í•˜ê³ , ë¶ˆí•„ìš”í•œ ì„œë¹„ìŠ¤ ì¹´íƒˆë¡œê·¸ë‚˜ ë¸Œë¡œì»¤, ì˜ˆì œ í…œí”Œë¦¿ ë“±ì€ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.

```ini
# Cluster Monitoring
openshift_cluster_monitoring_operator_node_selector={'node-role.kubernetes.io/infra':'true'}
openshift_cluster_monitoring_operator_prometheus_storage_enabled=true
openshift_cluster_monitoring_operator_alertmanager_storage_enabled=true
openshift_cluster_monitoring_operator_prometheus_storage_capacity='50Gi'
openshift_cluster_monitoring_operator_alertmanager_storage_capacity='2Gi'

# Other Components
openshift_console_install=true
openshift_hosted_manage_router=false
openshift_hosted_manage_registry=false
openshift_hosted_manage_registry_console=false
openshift_enable_service_catalog=false
template_service_broker_install=false
ansible_service_broker_install=false

# Example Templates
openshift_install_examples=false
openshift_examples_modify_imagestreams=false
```

### ê³ ê¸‰ ì„¤ì • ë° ì„¤ì¹˜ ê²€ì¦ ë¹„í™œì„±í™”

ì„¤ì¹˜ ê³¼ì •ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê²€ì¦(Check) ë‹¨ê³„ë¥¼ ê±´ë„ˆë›°ì–´ ì„¤ì¹˜ ì‹œê°„ì„ ë‹¨ì¶•í•˜ê³ , Podê°€ ë°°í¬ë  ê¸°ë³¸ ë…¸ë“œë¥¼ `compute` ì—­í• ë¡œ ì§€ì •í•©ë‹ˆë‹¤.

```ini
# Hostname validation disabling
openshift_hostname_check=false
openshift_set_hostname=false
openshift_override_hostname_check=false

# Enable unsupported configurations
openshift_enable_unsupported_configurations=false

# Disable specific pre-install checks
openshift_disable_check=memory_availability,disk_availability,docker_image_availability,docker_storage,package_version,package_availability

# Default node selector for project pods
osm_default_node_selector='node-role.kubernetes.io/compute=true'

# Storage plugin dependencies to install
osn_storage_plugin_deps=[]

# Firewall management
os_firewall_use_firewalld=false
```

### ë…¸ë“œ ê·¸ë£¹ ì •ì˜

í´ëŸ¬ìŠ¤í„°ì— í¬í•¨ë  ë…¸ë“œë“¤ì˜ ì—­í• (master, infra, compute ë“±)ê³¼ ê° ê·¸ë£¹ì— ë¶€ì—¬ë  ë ˆì´ë¸” ë° ì„¸ë¶€ ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤.

```ini
openshift_node_groups=[{'name': 'node-config-master', 'labels': ['node-role.kubernetes.io/master=true']}, {'name': 'node-config-infra', 'labels': ['node-role.kubernetes.io/infra=true']}, {'name': 'node-config-router', 'labels': ['node-role.kubernetes.io/router=true']}, {'name': 'node-config-compute-vm', 'labels': ['node-role.kubernetes.io/compute=true']}, {'name': 'node-config-compute-baremetal', 'labels': ['node-role.kubernetes.io/compute=true']}, {'name': 'node-config-compute', 'labels': ['node-role.kubernetes.io/compute=true'], 'edits': [{ 'key': 'kubeletArguments.pods-per-core','value': ['20']}]}]
```

## í˜¸ìŠ¤íŠ¸ ê·¸ë£¹ ì •ì˜

ê° ê·¸ë£¹ì— ì†í•˜ëŠ” ì„œë²„ë“¤ì˜ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì§€ì •í•˜ê³ , ë…¸ë“œ ì—­í• ì„ í• ë‹¹í•©ë‹ˆë‹¤. `[new_nodes]` ê·¸ë£¹ì€ í´ëŸ¬ìŠ¤í„° í™•ì¥ì— ì‚¬ìš©ë©ë‹ˆë‹¤.

```ini
[masters]
mst01.ocp3.cloudpang.lan
mst02.ocp3.cloudpang.lan
mst03.ocp3.cloudpang.lan

[etcd]
mst01.ocp3.cloudpang.lan
mst02.ocp3.cloudpang.lan
mst03.ocp3.cloudpang.lan

[nodes]
mst01.ocp3.cloudpang.lan    openshift_node_group_name="node-config-master"
mst02.ocp3.cloudpang.lan    openshift_node_group_name="node-config-master"
mst03.ocp3.cloudpang.lan    openshift_node_group_name="node-config-master"
ifr01.ocp3.cloudpang.lan    openshift_node_group_name="node-config-infra"
ifr02.ocp3.cloudpang.lan    openshift_node_group_name="node-config-infra"
```

-----

## ğŸ“ ì¸ë²¤í† ë¦¬ íŒŒì¼

```bash
vi ose-v3.11.784-inventory-hosts
```

```ini
################################################################################
###
### OpenShift Container Platform 3.11 Ansible Inventory File
###
### File: ose-v3.11.784-inventory-hosts
###
################################################################################

[OSEv3:children]
masters
nodes
etcd
#new_nodes

[OSEv3:vars]
### ==============================================================================
### Global Variables
### ==============================================================================
ansible_ssh_user=root
ansible_become=true

### ------------------------------------------------------------------------------
### Deployment & Version Settings
### ------------------------------------------------------------------------------
### Set to 'openshift-enterprise' for OpenShift Container Platform
openshift_deployment_type=openshift-enterprise

### Set debug log level (0=errors/warnings, 2=normal, 4=debug, 6=API debug, 8=API body debug)
debug_level=2

### Specify container image tag to install
openshift_image_tag=v3.11.784

### Specify RPM version to install
openshift_pkg_version=-3.11.784

### ------------------------------------------------------------------------------
### Disconnected/Offline Installation Settings
### ------------------------------------------------------------------------------
### For containerized etcd, specify the etcd image on your local registry
osm_etcd_image=bst01.ocp3.cloudpang.lan:5000/rhel7/etcd:3.2.28

### Set to the alternate image location for offline installation
oreg_url=bst01.ocp3.cloudpang.lan:5000/openshift3/ose-${component}:${version}

### Disable use of the default Red Hat registry (registry.redhat.io)
openshift_docker_ent_reg=''

### ------------------------------------------------------------------------------
### Master API, Console, and HA Settings
### ------------------------------------------------------------------------------
### Configure master API and console ports
openshift_master_api_port=8443
openshift_master_console_port=8443

### HA method for multiple masters (native is required)
openshift_master_cluster_method=native

### Internal load balancer hostname for master API access
openshift_master_cluster_hostname=master.ocp3.cloudpang.lan

### External/Public load balancer hostname
openshift_master_cluster_public_hostname=csmaster.ocp3.cloudpang.lan

### Default subdomain for exposed routes (e.g., *.apps.example.com)
openshift_master_default_subdomain=apps.ocp3.cloudpang.lan

### ------------------------------------------------------------------------------
### Docker Settings
### ------------------------------------------------------------------------------
### To specify an exact Docker version (e.g., 1.13.1), uncomment the line below
#docker_version=1.13.1

### Add insecure registries to the Docker configuration
openshift_docker_insecure_registries='bst01.ocp3.cloudpang.lan:5000,172.32.0.0/16,docker-registry.default.svc:5000'

### Configure additional Docker daemon options
openshift_docker_options='-l warn --log-opt max-size=20M --log-opt max-file=3'

### ------------------------------------------------------------------------------
### Network Settings (SDN)
### ------------------------------------------------------------------------------
### OpenShift SDN plug-in to use
os_sdn_network_plugin_name='redhat/openshift-ovs-multitenant'

### SDN cluster network CIDR for Pods
osm_cluster_network_cidr=172.33.0.0/16

### Subnet for Services
openshift_portal_net=172.32.0.0/16

### Per-host subnet length for Pod IPs
osm_host_subnet_length=9

### ------------------------------------------------------------------------------
### Certificate and Security Settings
### ------------------------------------------------------------------------------
### Validity of auto-generated certificates in days
openshift_ca_cert_expire_days=36500
openshift_node_cert_expire_days=36500
openshift_master_cert_expire_days=36500
etcd_ca_default_days=36500
openshift_hosted_registry_cert_expire_days=36500

### Automatic approval of node certificate signing requests (CSRs)
openshift_master_bootstrap_auto_approve=true
openshift_master_bootstrap_auto_approver_node_selector={"node-role.kubernetes.io/master":"true"}
osm_controller_args={"experimental-cluster-signing-duration": ["20m"]}

### Identity provider configuration
openshift_master_identity_providers=[{'name': 'htpasswd_auth', 'login': 'true', 'challenge': 'true', 'kind': 'HTPasswdPasswordIdentityProvider'}]

### ------------------------------------------------------------------------------
### Optional Components and Add-ons
### ------------------------------------------------------------------------------
### Cluster Monitoring Operator
openshift_cluster_monitoring_operator_node_selector={'node-role.kubernetes.io/infra':'true'}
openshift_cluster_monitoring_operator_prometheus_storage_enabled=true
openshift_cluster_monitoring_operator_alertmanager_storage_enabled=true
openshift_cluster_monitoring_operator_prometheus_storage_capacity='50Gi'
openshift_cluster_monitoring_operator_alertmanager_storage_capacity='2Gi'

### Other Components
openshift_console_install=true
openshift_hosted_manage_router=false
openshift_hosted_manage_registry=false
openshift_hosted_manage_registry_console=false
openshift_enable_service_catalog=false
template_service_broker_install=false
ansible_service_broker_install=false

### Example Templates
openshift_install_examples=false
openshift_examples_modify_imagestreams=false

### ------------------------------------------------------------------------------
### Advanced Settings & Pre-install Check Disabling
### ------------------------------------------------------------------------------
### Disable hostname validation checks
openshift_hostname_check=false
openshift_set_hostname=false
openshift_override_hostname_check=false

### Enable unsupported configurations (not for production)
openshift_enable_unsupported_configurations=false

### Disable specific pre-install checks
openshift_disable_check=memory_availability,disk_availability,docker_image_availability,docker_storage,package_version,package_availability

### Default node selector for project pods
osm_default_node_selector='node-role.kubernetes.io/compute=true'

### Storage plugin dependencies to install
osn_storage_plugin_deps=[]

### Firewall management (use firewalld instead of iptables)
os_firewall_use_firewalld=false

### ------------------------------------------------------------------------------
### Node Group Definitions
### ------------------------------------------------------------------------------
openshift_node_groups=[{'name': 'node-config-master', 'labels': ['node-role.kubernetes.io/master=true']}, {'name': 'node-config-infra', 'labels': ['node-role.kubernetes.io/infra=true']}, {'name': 'node-config-router', 'labels': ['node-role.kubernetes.io/router=true']}, {'name': 'node-config-compute-vm', 'labels': ['node-role.kubernetes.io/compute=true']}, {'name': 'node-config-compute-baremetal', 'labels': ['node-role.kubernetes.io/compute=true']}, {'name': 'node-config-compute', 'labels': ['node-role.kubernetes.io/compute=true'], 'edits': [{ 'key': 'kubeletArguments.pods-per-core','value': ['20']}]}]


### ==============================================================================
### Host Group Definitions
### ==============================================================================

[masters]
mst01.ocp3.cloudpang.lan
mst02.ocp3.cloudpang.lan
mst03.ocp3.cloudpang.lan

[etcd]
mst01.ocp3.cloudpang.lan
mst02.ocp3.cloudpang.lan
mst03.ocp3.cloudpang.lan

[nodes]
mst01.ocp3.cloudpang.lan    openshift_node_group_name="node-config-master"
mst02.ocp3.cloudpang.lan    openshift_node_group_name="node-config-master"
mst03.ocp3.cloudpang.lan    openshift_node_group_name="node-config-master"
ifr01.ocp3.cloudpang.lan    openshift_node_group_name="node-config-infra"
ifr02.ocp3.cloudpang.lan    openshift_node_group_name="node-config-infra"

#[new_nodes]
#ifr03.ocp3.cloudpang.lan    openshift_node_group_name="node-config-infra"
#rtr01.ocp3.cloudpang.lan    openshift_node_group_name="node-config-router"
#rtr02.ocp3.cloudpang.lan    openshift_node_group_name="node-config-router"
#wrk01.ocp3.cloudpang.lan    openshift_node_group_name="node-config-compute"
#wrk02.ocp3.cloudpang.lan    openshift_node_group_name="node-config-compute"
#wrk03.ocp3.cloudpang.lan    openshift_node_group_name="node-config-compute-baremetal"
```